<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Dofus Treasure Hunt Clues</title>
    <link rel="search"
          href="https://hagabaka.github.io/dofus-treasure-hunt-clues/opensearch.xml"
          type="application/opensearchdescription+xml"
          title="Search by clue text or author">
    <script type='text/javascript'
            src='//cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js'>
    </script>
    <script type='text/javascript'
            src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js'>
    </script>
    <script type='text/javascript'>
      var viewModel = {filter: ko.observable(''), loading: ko.observable(true)};
      $(function() {
        function contains(text, substring) {
          return text.toLowerCase().indexOf(substring.toLowerCase()) >= 0;
        }

        viewModel.filter.subscribe(function(filter) {
          var hash;
          if(filter) {
            hash = 'filter:' + escape(filter);
          } else {
            hash = '';
          }
          location.hash = hash;
        });
        function setFilterFromHash() {
          var filter;
          var match = /filter:(.+)/.exec(location.hash);
          if(match) {
            filter = unescape(match[1]);
          } else {
            filter = ''
          }
          viewModel.filter(filter);
        }
        window.onhashchange = setFilterFromHash;
        setFilterFromHash();

        $.getJSON('clues.json', function(data) {
          viewModel.clues = data.filter(function(entry) {
            return !/~/.test(entry.clue);
          });

          viewModel.clues.forEach(function(entry) {
            entry.matching = ko.computed(function() {
              return contains(entry.clue, viewModel.filter());
            });

            entry.images.forEach(function(image) {
              image.matching = ko.computed(function() {
                return image.sources.some(function(source) {
                  return contains(source.author, viewModel.filter());
                });
              });

              image.shouldShow = ko.computed(function() {
                return entry.matching() || image.matching();
              });
            });

            entry.shouldShow = ko.computed(function() {
              return entry.images.some(function(image) {
                return image.shouldShow();
              });
            });
          });

          viewModel.numberOfVisibleClues = ko.computed(function() {
            return viewModel.clues.filter(function(clue) {
              return clue.shouldShow();
            }).length;
          });
          ko.applyBindings(viewModel);
          viewModel.loading(false);
        });
      });
    </script>
    <style type='text/css'>
      body {
        padding: 1em;
      }
      body, .clue {
        background-image: url('data:image/png;base64,\
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');
      }
      #dynamic.loading {
        visibility: hidden;
      }
      .loading::before {
        visibility: visible;
        display: block;
        text-align: center;
        content: 'âŒ› Loading...';
        color: gray;
        font-size: large;
      }
      .accesskey {
        text-decoration: underline;
      }
      #filter-form {
        padding: 0.5em;
        border-width: 0 1px 1px 1px;
        border-color: black;
        border-style: solid;
        background-color: black;
        background-color: rgba(0, 0, 0, 0.8);
        margin: 0 auto;
        position: fixed;
        top: 0;
        box-shadow: 0.2em 0 0.2em 0 black;
      }
      #filter-form > label::before {
        content: 'ðŸ”Ž '
      }
      #filter {
        margin: 0;
        background: transparent;
        border: none;
        outline: none;
      }
      /* try to hide Chrome's autofill background color */
      #filter:-webkit-autofill {
        box-shadow: 0 0 0 2em rgba(0, 0, 0, 0.8) inset;
        -webkit-text-fill-color: white;
      }
      #clear-filter {
        position: absolute;
        right: 1em;
        top: 50%;
        bottom: 0;
        height: 100%;
        margin: auto;
        text-decoration: none;
        visibility: hidden;
      }
      #clear-filter::before {
        content: 'âŒ« ';
      }
      #filter-form, #filter, #clear-filter {
        color: white;
        text-shadow: 1px 1px black;
      }
      #filter.filled ~ #clear-filter {
        visibility: visible;
      }
      ul, li {
        list-style: none;
        padding: 0;
      }
      .image > a {
        text-decoration: none;
      }
      img {
        height: 7em;
        box-shadow: 0.2em 0.2em 0.2em grey;
        border: 1px solid white;
      }
      #clues, h1 {
        text-align: center;
      }
      h1 ~ p, #dynamic > p {
        padding: 0;
        margin: 0 15% 1em;
        text-align: justify;
      }
      #clues > li {
        display: inline-block;
        vertical-align: top;
        margin: 1em 1em;
        padding: 0 0.5em;
        background: radial-gradient(ellipse 30em 100% at top,
                    transparent, transparent 20%, rgba(0, 0, 0, 0.2));
        box-shadow: inset 0 0 0.3em rgba(0, 0, 0, 0.4);
        border: 1px solid white;
      }
      .clue {
        padding: 0 0.5em;
        margin: 0 auto;
        background-color: white;
        font-style: italic;
        margin-top: -0.75em;
        display: table;
      }
      .images > li {
        display: inline-block;
        margin: 1em;
      }
      .image p::before {
        content: ' ';
        display: block;
      }
      .image p, .sources, .sources > li {
        display: inline;
        padding: 0;
        margin: 0;
      }
      .image p {
        font-size: x-small;
      }
      .sources > li {
        font-size: small;
      }
      .sources > li::after {
        content: ' & ';
        font-size: x-small;
      }
      .sources > li:last-child::after {
        content: '';
      }
    </style>
  </head>

  <body>
    <h1>Dofus Treasure Hunt Clues</h1>
    <p>Thank you for using this dictionary of <a target='external' href='http://www.dofus.com'>
       Dofus</a> treasure hunt clues, built from posts on an <a target='impsvillage'
       href='http://impsvillage.com/forums/topic/141320-treasure-hunting-the-guide/'>ImpsVillage
       forum thread</a> started by UltimateSensation.</p>
    <p>You can use the box on the top-left corner to filter by clue text or author. You can also
       <a href='#' onClick='external.AddSearchProvider("https://hagabaka.github.io/dofus-treasure-hunt-clues/opensearch.xml"); return false'>add</a> this as a search engine in your browser.</p>
    <p>The <a target='external' href='https://github.com/hagabaka/dofus-treasure-hunt-clues'>
       script</a> that generates this page assumes that clues are at most 9 words long, start
       with letters, contain only letters, dash, comma, apostrophe, double quotes, parentheses,
       and whitespace, and always appear before their images. If you see an image you posted
       that has the wrong clue here, you could edit your post following these rules, and next
       time I update this page it will hopefully get corrected.</p>
    <div id='filter-form'>
      <label for='filter' accesskey='f'><span class='accesskey'>F</span>ilter: </label>
      <input id='filter' size='50' type='text'
             placeholder='Type part of clue or author name and press Enter to filter'
             data-bind='value: filter, css: {filled: filter}'></input>
      <a id='clear-filter' accesskey='c' title='Clear filter'
         href='#' onClick='viewModel.filter(""); return false'>
         <span class='accesskey'>C</span>lear</a>
    </div>
    <div id='dynamic' class='loading' data-bind='css: {loading: loading}'>
      <p>There are <span data-bind='text: numberOfVisibleClues'></span> clues<span data-bind='if: filter'>
        matching the filter "<span data-bind='text: filter'></span>"</span>.</p>
      <ul id='clues' data-bind='foreach: clues'>
        <li data-bind='visible: shouldShow'>
          <span class='clue' data-bind='text: clue'></span>

          <ul class='images' data-bind='foreach: images'>
            <li class='image' data-bind='visible: shouldShow'>
              <a title='View in full size' target='image' data-bind='attr: {href: image}'>
                <img data-bind='attr: {src: image}'>
              </a>
              <p>Posted by</p>
              <ul class='sources' data-bind='foreach: sources'>
                <li>
                  <a title='Open post' target='impsvillage'
                    data-bind='attr: {href: post}, text: author'></a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </body>
</html>
